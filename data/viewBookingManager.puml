@startuml viewBookingForManager

hide footbox
mainframe <b>sd</b> View Booking Information for Manager
actor User
participant "Browser" as Browser
participant ":ManagerRoleFilter" as ManagerRoleFilter
participant ":Helper" as Helper
participant ":ViewBookingManagerController" as ViewBookingManagerController
participant ":GetParam" as GetParam
participant ":BookingInfoDAO" as BookingInfoDAO
participant "Database" as DB

User ->> Browser: Click on view booking Link
activate Browser
Browser ->> ManagerRoleFilter: GET /ViewBookingManagerController
activate ManagerRoleFilter
ManagerRoleFilter ->> ManagerRoleFilter: Context.lookup(String name): Object
ManagerRoleFilter ->> Helper: protectedRouter(HttpServletRequest request, HttpServletResponse response, int minRole, int maxRole, String page): boolean
activate Helper
Helper ->> Helper: isLogin(HttpServletRequest request): boolean
Helper ->> Helper: correctRole(HttpServletRequest request, int minRole, int maxRole): boolean
alt return false 
    Helper -->> ManagerRoleFilter: forward login.jsp
    ManagerRoleFilter -->> Browser: forward login.jsp
else return true
    Helper -->> ManagerRoleFilter: return true
    deactivate Helper
    ManagerRoleFilter ->> ViewBookingManagerController: doFilter(ServletRequest arg0, ServletResponse arg1): void

    activate ViewBookingManagerController
    ViewBookingManagerController ->> GetParam: getDateParams(HttpServletRequest request, String field, String label, String defaultValue): Date
    activate GetParam
    GetParam -->> ViewBookingManagerController:return startDate, endDate 
    ViewBookingManagerController ->> GetParam: getIntParams(HttpServletRequest request, String field, String label, int min, int max, Integer defaultValue): Integer
    GetParam -->> ViewBookingManagerController:return roomId, status
    deactivate GetParam
    alt invalid data 
        ViewBookingManagerController -->> ManagerRoleFilter: forward viewBookingManager.jsp
        ManagerRoleFilter -->> Browser: forward viewBookingManager.jsp
    else 
        ViewBookingManagerController ->> ViewBookingManagerController: Validator.computeNumberOfDay(HttpServletRequest request, Date startDate, Date endDate): Integer
        alt invalid date 
            ViewBookingManagerController -->> ManagerRoleFilter: forward viewBookingManager.jsp
            ManagerRoleFilter -->> Browser: forward viewBookingManager.jsp
        else valid date
            ViewBookingManagerController ->>  BookingInfoDAO: getBookingForManager(String roomId, Date startDate, Date endDate, Integer status): ArrayList<BookingInfo>
            activate BookingInfoDAO
            BookingInfoDAO ->> DB: executeQuery(): ResultSet
            activate DB
            DB -->> BookingInfoDAO: return ResultSet
            deactivate DB
            BookingInfoDAO -->> ViewBookingManagerController: return ArrayList<BookingInfo>
            deactivate BookingInfoDAO
            ViewBookingManagerController ->> ViewBookingManagerController: HttpServletRequest.setAttribute(String arg0, Object arg1): void
            ViewBookingManagerController -->> ManagerRoleFilter: forward viewBookingManager.jsp
            deactivate ViewBookingManagerController
            ManagerRoleFilter -->> Browser: forward viewBookingManager.jsp
            deactivate ManagerRoleFilter
            deactivate Browser
        end
    end
end

@enduml