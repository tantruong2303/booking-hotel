@startuml viewRoomController

mainframe **sd** View Room Controller
hide footbox
actor User
participant "Browser" as Browser
participant "CommonFilter" as CommonFilter
participant ":ViewRoomController" as ViewRoomController
participant "Helper" as Helper
participant "GetParam" as GetParam
participant ":UserDAO" as UserDAO
participant ":RoomDAO" as RoomDAO
participant ":ReviewDAO" as ReviewDAO
participant "Database" as Database

User ->> Browser: Click on view room link
activate Browser
Browser ->> CommonFilter: **GET** /ViewRoomController
activate CommonFilter
CommonFilter ->> CommonFilter: Context.lookup(String name): Object
CommonFilter ->> Helper: protectedRouter(HttpServletRequest request, HttpServletResponse response, int minRole, int maxRole, String page): boolean
activate Helper
Helper ->> Helper: isLogin(HttpServletRequest request): boolean
Helper ->> Helper: correctRole(HttpServletRequest request, int minRole, int maxRole): boolean
Helper -->> CommonFilter: Return result
deactivate Helper

alt action does not allow
    CommonFilter -->> Browser: forward login.jsp

else action allows
    CommonFilter ->> ViewRoomController: doFilter(ServletRequest arg0, ServletResponse arg1): void
    activate ViewRoomController
    ViewRoomController ->> GetParam: getIntParams(HttpServletRequest request, String field, String label, int min, int max, Integer defaultValue): Integer
    activate GetParam
    GetParam -->> ViewRoomController: Return roomId
    deactivate GetParam

    alt invalid data
        ViewRoomController -->> CommonFilter: forward error.jsp
        CommonFilter -->> Browser: forward error.jsp
    else valid data
        ViewRoomController ->> RoomDAO: getRoomById(int roomId): Room
        activate RoomDAO
        RoomDAO ->> Database: executeQuery(): ResultSet
        activate Database
        Database -->> RoomDAO: Return ResultSet
        deactivate Database
        RoomDAO -->> ViewRoomController: Return Room
        deactivate RoomDAO

        alt null
            ViewRoomController -->> CommonFilter: forward error.jsp
            CommonFilter -->> Browser: forward error.jsp
        else not null
            ViewRoomController ->> ReviewDAO: getReviewByRoomId(int roomId): ArrayList<Review>
            activate ReviewDAO
            ReviewDAO ->> Database: executeQuery(): ResultSet
            activate Database
            Database -->> ReviewDAO: Return ResultSet
            deactivate Database
            ReviewDAO -->> ViewRoomController: Return ArrayList<Review>
            deactivate ReviewDAO

            alt null
                ViewRoomController -->> CommonFilter: forward error.jsp
                CommonFilter -->> Browser: forward error.jsp
            else not null
                ViewRoomController ->> ViewRoomController: HttpServletRequest.setArribute(String arg0, Object arg1): void
                ViewRoomController -->> CommonFilter: forward viewRoomInfo.jsp
                deactivate ViewRoomController
                CommonFilter -->> Browser: forward viewRoomInfo.jsp
                deactivate CommonFilter
                deactivate Browser
            end

        end
    end
end
@enduml